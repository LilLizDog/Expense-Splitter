<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Expense Splitter - Add Expense</title>

  <style>
    :root{
      --green: #16a34a;
      --green-600: #15803d;
      --red: #b91c1c;
      --orange: #f97316;
      --black: #111111;
      --bg: #f6f7f8;
      --card: #ffffff;
      --muted: #6b7280;

      --sidebar-w: 220px;
      --radius: 14px;
      --shadow: 0 8px 20px rgba(0,0,0,0.06);
      --content-max: 1120px;
    }

    * { box-sizing: border-box; }
    body{
      margin:0;
      background: var(--bg);
      color: var(--black);
      font-family: Arial, Helvetica, sans-serif;
      font-size: 15px;
      line-height: 1.35;
    }

    .topbar{
      position: sticky; top:0; z-index: 40;
      height: 56px;
      background: #fff;
      box-shadow: var(--shadow);
      display:flex; align-items:center; gap:12px;
      padding: 0 14px;
    }
    .brand{ font-weight: 800; font-size: 1.6rem; letter-spacing: .2px; }
    .brand .accent{ color: var(--green); }

    .layout{ display:block; min-height: calc(100dvh - 56px); }

    #nav-toggle{ display:none; }
    .hamburger{ width:26px; height:20px; cursor:pointer; display:grid; gap:5px; }
    .hamburger span{ display:block; height:3px; background:var(--black); border-radius:2px; }

    .sidebar{
      position: fixed; left:0; top:56px; z-index: 50;
      width: 0; padding:0;
      height: calc(100dvh - 56px);
      background:#fff;
      box-shadow: var(--shadow);
      overflow: hidden;
      transform: translateX(-100%);
      transition: transform .25s ease, width .25s ease, padding .25s ease;
    }
    #nav-toggle:checked ~ .layout .sidebar{
      transform: translateX(0);
      width: var(--sidebar-w);
      padding: 14px;
    }

    .nav-title{ font-size:.85rem; color:var(--muted); margin: 6px 8px 10px; }
    .nav{ display:flex; flex-direction: column; gap:6px; }
    .nav a{
      display:flex; align-items:center; gap:10px;
      padding:10px 12px; border-radius:10px; text-decoration:none;
      color:var(--black); font-size:14px;
    }
    .nav a:hover{ background:#f1f5f9; }
    .nav a.active{ background:#e8f8ee; color:var(--green-600); font-weight:600; }
    .nav a svg{ width:18px; height:18px; stroke:currentColor; fill:none; stroke-width:2; flex:0 0 18px; }

    .main{ padding:20px; max-width:var(--content-max); margin-inline:auto; }
    .panel{
      background: var(--card);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 16px;
    }
    h1{ margin:0 0 8px; font-size:1.5rem; }
    .muted{ color: var(--muted); }

    label{ font-weight:600; display:block; margin:10px 0 6px; }
    input, select, textarea{
      width:100%; padding:10px 12px; font-size:14px;
      border:1px solid #e5e7eb; border-radius:12px; outline:none; background:#fff;
    }

    .money-field {
      position: relative;
    }
    .money-field .prefix {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--muted);
      font-weight: 600;
    }
    .money-field input {
      padding-left: 28px;
      -moz-appearance: textfield;
    }
    .money-field input::-webkit-outer-spin-button,
    .money-field input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    input:focus, select:focus, textarea:focus{
      border-color:#d1d5db; box-shadow: var(--shadow);
    }

    .actions{
      margin-top:14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .btn{
      border:1px solid #e5e7eb; background:#fff; border-radius:12px;
      padding:9px 12px; text-decoration:none; color:var(--black); font-weight:600;
      box-shadow: var(--shadow); font-size:14px; cursor:pointer;
    }
    .btn[disabled]{
      opacity:0.6;
      cursor:not-allowed;
    }
    .btn:hover{ border-color:#d1d5db; }
    .btn.primary{ background:#e8f8ee; color:var(--green-600); border-color:#cdebdc; }

    .split-row{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:4px;
    }
    .split-row label{
      font-weight:400;
      margin:0;
      display:flex;
      align-items:center;
      gap:6px;
      white-space:nowrap;
    }
    .split-row input[type="radio"]{
      margin:0;
    }

    .error-text{
      color:var(--red);
      font-size:0.85rem;
      margin-top:4px;
      display:none;
    }
    .req{
      color:var(--red);
    }

    .dd-btn{
      width:100%; padding:10px 12px; border:1px solid #e5e7eb; border-radius:12px;
      background:#fff; text-align:left; cursor:pointer; font-size:14px;
    }
    .dd-btn[disabled]{ opacity:.6; cursor:not-allowed; }

    .dd-panel{
      margin-top:8px; border:1px solid #e5e7eb; background:#fff; border-radius:12px;
      box-shadow: 0 10px 30px rgba(0,0,0,.08); padding:10px;
    }
    .dd-head{ display:flex; gap:10px; align-items:center; margin-bottom:8px; }
    .dd-check{
      display:flex;
      align-items:center;
      gap:8px;
      user-select:none;
      flex:0 0 auto;
      white-space:nowrap;
    }
    .dd-check input[type="checkbox"]{
      margin:0 6px 0 2px;
    }

    .dd-search{
      flex:1 1 auto;
      min-width:0;
      padding:8px 10px;
      border:1px solid #e5e7eb;
      border-radius:10px;
      font-size:14px;
    }

    .dd-list{
      display:flex;
      flex-direction:column;
      align-items:flex-start;
      max-height:240px;
      overflow:auto;
      padding:6px 2px;
      text-align:left;
    }

    .dd-item{
      display:flex;
      align-items:center;
      gap:8px;
      padding:6px 8px;
      border-radius:8px;
      cursor:pointer;
      justify-content:flex-start;
      width:max-content;
      max-width:100%;
    }
    .dd-item:hover{ background:#f3f4f6; }
    .dd-item input[type="checkbox"]{ margin:0 8px 0 2px; }
    .dd-item span{ flex:0 0 auto; display:inline-block; }

    .dd-actions{ display:flex; justify-content:flex-end; gap:8px; margin-top:8px; }
    .dd-primary{ padding:8px 12px; border-radius:10px; border:1px solid #111; background:#111; color:#fff; }
    .dd-link{ background:transparent; border:none; color:#6B7280; padding:8px; cursor:pointer; }

    .hidden{ display:none !important; }

    .status-badge{
      font-size:0.85rem;
      margin-top:4px;
      font-weight:600;
      display:none;
    }
    .status-badge.under{
      color:var(--red);
    }
    .status-badge.over{
      color:var(--orange);
    }
  </style>
</head>

<body>

  <header class="topbar">
    <label for="nav-toggle" class="hamburger" title="Menu">
      <span></span><span></span><span></span>
    </label>
    <div class="brand">Expense <span class="accent">Splitter</span></div>
  </header>

  <input id="nav-toggle" type="checkbox"/>

  <div class="layout">
    <aside class="sidebar">
      <div class="nav-title">Menu</div>
      <nav class="nav">
        <a href="/dashboard">
          <svg viewBox="0 0 24 24"><path d="M3 10.5 12 3l9 7.5v9a1 1 0 0 1-1 1h-5v-6H9v6H4a1 1 0 0 1-1-1z"/></svg>
          Home
        </a>
        <a href="#">
          <svg viewBox="0 0 24 24"><circle cx="11" cy="11" r="7"/><path d="M20 20l-3.5-3.5"/></svg>
          Search
        </a>
        <a href="#">
          <svg viewBox="0 0 24 24"><path d="M7 20a4 4 0 1 1 10 0"/><circle cx="12" cy="8" r="3"/><path d="M2 20a4 4 0 0 1 6-3.46"/><path d="M22 20a4 4 0 0 0-6-3.46"/></svg>
          Groups
        </a>
        <a href="#">
          <svg viewBox="0 0 24 24"><circle cx="8" cy="8" r="3"/><circle cx="16" cy="8" r="3"/><path d="M2 20a6 6 0 0 1 12 0"/><path d="M10 20a6 6 0 0 1 12 0"/></svg>
          Friends
        </a>
        <a href="#">
          <svg viewBox="0 0 24 24"><path d="M3 12a9 9 0 1 0 3-6.7"/><path d="M3 3v6h6"/><path d="M12 7v6l4 2"/></svg>
          History
        </a>
        <a href="#">
          <svg viewBox="0 0 24 24"><path d="M3 7h14a4 4 0 0 1 4 4v2a4 4 0 0 1-4 4H3z"/><path d="M17 11h4v2h-4z"/></svg>
          Wallet
        </a>
        <a href="#">
          <svg viewBox="0 0 24 24"><path d="M6 8a6 6 0 1 1 12 0v5l2 3H4l2-3z"/><path d="M9 19a3 3 0 0 0 6 0"/></svg>
          Notifications
        </a>
        <a class="active" href="/add-expense">
          <svg viewBox="0 0 24 24"><path d="M12 5v14M5 12h14"/></svg>
          Add Expense
        </a>
      </nav>
    </aside>

    <main class="main">
      <section class="panel" style="max-width: 920px; margin-inline:auto;">
        <h1>Add Expense</h1>
        <p class="muted">Enter details below to add a new expense.</p>

        <form id="expenseForm" onsubmit="return false;">

          <label>Is this a group expense? <span class="req">*</span></label>
          <div class="split-row">
            <label>
              <input type="radio" name="is_group_expense" value="yes" checked />
              <span>Yes</span>
            </label>
            <label>
              <input type="radio" name="is_group_expense" value="no" />
              <span>No</span>
            </label>
          </div>

          <div id="groupSection">
            <label for="group">Group <span class="req">*</span></label>
            <select id="group" name="group" required>
              <option value="" disabled selected>Select a group...</option>
            </select>

            <label for="memberBtn" style="margin-top:12px;">Members <span class="req">*</span></label>
            <button id="memberBtn" class="dd-btn" type="button" disabled aria-expanded="false">
              Choose a group first.
            </button>

            <div id="memberPanel" class="dd-panel hidden" role="dialog" aria-label="Select members">
              <div class="dd-head">
                <label class="dd-check">
                  <input type="checkbox" id="memberSelectAll" />
                  <span>Select all</span>
                </label>
                <input id="memberSearch" class="dd-search" type="text" placeholder="Search membersâ€¦">
              </div>

              <div id="memberList" class="dd-list" role="listbox" aria-multiselectable="true"></div>

              <div class="dd-actions">
                <button type="button" id="memberDone" class="dd-primary">Done</button>
                <button type="button" id="memberClear" class="dd-link">Clear</button>
              </div>
            </div>

            <div id="memberHiddenInputs" class="hidden"></div>
          </div>

          <div id="friendSection" class="hidden">
            <label for="friendSelect">Friends <span class="req">*</span></label>
            <select id="friendSelect" name="friend">
              <option value="" disabled selected>Select a friend...</option>
            </select>
            <div class="muted" style="font-size:0.85rem; margin-top:4px;">
              Missing someone? You can manage friends from the Friends page.
            </div>
          </div>

          <div id="friendSplitSection" class="hidden">
            <label>Split with this friend? <span class="req">*</span></label>
            <div class="split-row">
              <label>
                <input type="radio" name="friend_split" value="yes" />
                <span>Yes</span>
              </label>
              <label>
                <input type="radio" name="friend_split" value="no" checked />
                <span>No</span>
              </label>
            </div>

            <div id="friendCustomAmountWrap" class="hidden" style="margin-top:8px;">
              <div class="muted" style="font-size:0.9rem; margin-bottom:4px;">
                Enter how much this friend should owe.
              </div>
              <div class="money-field" style="max-width:240px;">
                <span class="prefix" aria-hidden="true">$</span>
                <input
                  id="friendCustomAmount"
                  type="number"
                  step="0.01"
                  inputmode="decimal"
                  placeholder="0.00"
                  min="0"
                />
              </div>
            </div>

            <div id="friendCustomPercentWrap" class="hidden" style="margin-top:8px;">
              <div class="muted" style="font-size:0.9rem; margin-bottom:4px;">
                Enter what percent of the total this friend should owe.
              </div>
              <div style="display:flex; align-items:center; gap:6px; max-width:260px;">
                <input
                  id="friendCustomPercent"
                  type="number"
                  step="0.01"
                  inputmode="decimal"
                  placeholder="0"
                  min="0"
                  max="100"
                  style="width:80px;"
                />
                <span>% of total</span>
              </div>
            </div>
          </div>

          <label for="date">Date <span class="req">*</span></label>
          <input id="date" name="date" type="date" required />

          <label for="expense_type">Expense Type <span class="req">*</span></label>
          <select id="expense_type" name="expense_type" required>
            <option value="" disabled selected>Select a type...</option>
            <option value="food">Food</option>
            <option value="groceries">Groceries</option>
            <option value="rent">Rent</option>
            <option value="utilities">Utilities</option>
            <option value="transportation">Transportation</option>
            <option value="entertainment">Entertainment</option>
            <option value="shopping">Shopping</option>
            <option value="health">Health</option>
            <option value="travel">Travel</option>
            <option value="household">Household</option>
            <option value="other">Other</option>
          </select>

          <label for="description">Description (optional)</label>
          <input id="description" name="description" type="text" placeholder="e.g. Pizza Night" />

          <label for="total">Total Amount <span class="req">*</span></label>
          <div class="money-field">
            <span class="prefix" aria-hidden="true">$</span>
            <input id="total" name="total" type="number" step="0.01" inputmode="decimal"
                   placeholder="0.00"
                   aria-label="Total amount in US dollars" required />
          </div>

          <div id="splitTypeSection">
            <label>Split Type <span class="req">*</span></label>
            <div class="split-row">
              <label>
                <input type="radio" name="split_type" value="equal" checked />
                <span>Equal</span>
              </label>
              <label>
                <input type="radio" name="split_type" value="amount" />
                <span>Custom amounts</span>
              </label>
              <label>
                <input type="radio" name="split_type" value="percentage" />
                <span>Custom percentages</span>
              </label>
            </div>
          </div>
          <div id="splitError" class="error-text"></div>

          <div id="customAmountSection" class="hidden" style="margin-top:8px;">
            <div class="muted" style="font-size:0.9rem; margin-bottom:4px;">
              Enter each member's share in dollars. Total must add up to the amount.
            </div>
            <div id="customAmountRows"></div>
            <div id="amountRemaining" class="status-badge"></div>
          </div>

          <div id="customPercentageSection" class="hidden" style="margin-top:8px;">
            <div class="muted" style="font-size:0.9rem; margin-bottom:4px;">
              Enter each member's share in percent. All percentages must add up to 100.
            </div>
            <div id="customPercentageRows"></div>
            <div id="percentageRemaining" class="status-badge"></div>
          </div>

          <div class="actions">
            <button class="btn primary" disabled>Save Expense</button>
            <div id="saveHint" class="error-text"></div>
          </div>
        </form>
      </section>
    </main>
  </div>
  
  <script type="module" src="/static/js/guard_protected.js"></script>
  <script src="/static/js/add_expense.js"></script>
</body>
</html>